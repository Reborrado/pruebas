<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Preguntas</title>
    <style>

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #e8f5e9; /* Fondo Verde Claro */
}

.container {
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

h1 {
    text-align: center;
    color: #000000; /* Verde Oscuro */
    font-size: 1.3em; /* Tamaño de fuente para el título */
    font-family: 'Arial', sans-serif; /* Tipo de fuente para el título */
    font-weight: bold; /* Peso de la fuente para hacer el título más destacado */
    margin: 0 0 20px; /* Márgenes para el título (0 arriba, 0 abajo, 20px en la parte inferior) */
}


.intro-text {
    margin-bottom: 20px; /* Espacio debajo del texto introductorio */
    font-size: 16px; /* Tamaño de fuente adecuado */
    line-height: 1.4; /* Altura de línea para mejorar la legibilidad */
}

.table-container {
    width: 100%; /* Asegura que el contenedor de la tabla ocupe todo el ancho disponible */
    overflow-x: auto; /* Permite el desplazamiento horizontal si es necesario */
}

table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed; /* Asegura que todas las celdas de la tabla tengan el mismo ancho */
}

thead th {
    background-color: #f1f8e9; /* Verde Muy Claro */
    color: #000000; /* Verde Más Oscuro */
}

th, td {
    border: 1px solid #000000; /* negro */
    padding: 8px;
    text-align: center;
    box-sizing: border-box; /* Incluye el padding y border en el ancho total de las celdas */
}

th:nth-child(1), td:nth-child(1) {
    width: 50%; /* Columna de preguntas ocupa el 80% del ancho */
}

th:nth-child(2), td:nth-child(2),
th:nth-child(3), td:nth-child(3),
th:nth-child(4), td:nth-child(4),
th:nth-child(5), td:nth-child(5),
th:nth-child(6), td:nth-child(6) {
    width: 10%; /* Cada columna de opciones de respuesta ocupa el ancho que debe ocupar*/
}

.question-header {
    text-align: center;
    font-weight: normal;
}

.question-cell {
    text-align: left;
}

.option-cell {
    text-align: center;
}

button {
    display: block;
    width: 100%;
    padding: 10px;
    background-color: #66bb6a; /* Verde Claro */
    color: #ffffff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    margin-top: 20px;
}

button:hover {
    background-color: #43a047; /* Verde Más Oscuro */
}

.hidden {
    display: none;
}

.result {
    padding: 10px;
    background-color: #e8f5e9; /* Verde Claro */
    border: 2px solid #66bb6a; /* Verde Claro */
    border-radius: 5px;
}



    </style>
</head>
<body>
    <div class="container">
        <h1>CUESTIONARIO DE FACTORES DE RIESGO PSICOSOCIAL INTRALABORAL</h1>
        <h1></h1>
        <h1>FORMA A</h1>

        <p class="intro-text">Por favor diligencie las siguientes preguntas relacionadas con la atención al cliente y usuarios</p>


        <form id="questionForm">
            <table>
                <thead>
                    <tr>
                        <th class="question-header"></th>
                        <th class="question-header">Siempre</th>
                        <th class="question-header">Casi Siempre</th>
                        <th class="question-header">Algunas Veces</th>
                        <th class="question-header">Casi Nunca</th>
                        <th class="question-header">Nunca</th>
                    </tr>
                </thead>
                <tbody>


<!-- Pregunta 106 -->
<tr>						
  <td class="question-cell">106. Atiendo clientes o usuarios muy enojados</td>			
  <td class="option-cell"><input type="radio" name="p106" value="4"></td>	
  <td class="option-cell"><input type="radio" name="p106" value="3"></td>
  <td class="option-cell"><input type="radio" name="p106" value="2"></td>
  <td class="option-cell"><input type="radio" name="p106" value="1"></td>
  <td class="option-cell"><input type="radio" name="p106" value="0"></td>	
</tr>						
						
<!-- Pregunta 107 -->
<tr>						
  <td class="question-cell">107. Atiendo clientes o usuarios muy preocupados</td>			
  <td class="option-cell"><input type="radio" name="p107" value="4"></td>	
  <td class="option-cell"><input type="radio" name="p107" value="3"></td>
  <td class="option-cell"><input type="radio" name="p107" value="2"></td>
  <td class="option-cell"><input type="radio" name="p107" value="1"></td>
  <td class="option-cell"><input type="radio" name="p107" value="0"></td>	
</tr>						
						
<!-- Pregunta 108 -->
<tr>						
  <td class="question-cell">108. Atiendo clientes o usuarios muy tristes</td>			
  <td class="option-cell"><input type="radio" name="p108" value="4"></td>	
  <td class="option-cell"><input type="radio" name="p108" value="3"></td>
  <td class="option-cell"><input type="radio" name="p108" value="2"></td>
  <td class="option-cell"><input type="radio" name="p108" value="1"></td>
  <td class="option-cell"><input type="radio" name="p108" value="0"></td>	
</tr>						
						
<!-- Pregunta 109 -->
<tr>						
  <td class="question-cell">109. Mi trabajo me exige atender personas muy enfermas</td>			
  <td class="option-cell"><input type="radio" name="p109" value="4"></td>	
  <td class="option-cell"><input type="radio" name="p109" value="3"></td>
  <td class="option-cell"><input type="radio" name="p109" value="2"></td>
  <td class="option-cell"><input type="radio" name="p109" value="1"></td>
  <td class="option-cell"><input type="radio" name="p109" value="0"></td>	
</tr>						
						
<!-- Pregunta 110 -->
<tr>						
  <td class="question-cell">110. Mi trabajo me exige atender personas muy necesitadas de ayuda</td>			
  <td class="option-cell"><input type="radio" name="p110" value="4"></td>	
  <td class="option-cell"><input type="radio" name="p110" value="3"></td>
  <td class="option-cell"><input type="radio" name="p110" value="2"></td>
  <td class="option-cell"><input type="radio" name="p110" value="1"></td>
  <td class="option-cell"><input type="radio" name="p110" value="0"></td>	
</tr>						
						
<!-- Pregunta 111 -->
<tr>						
  <td class="question-cell">111. Atiendo a clientes o usuarios que me maltratan</td>			
  <td class="option-cell"><input type="radio" name="p111" value="4"></td>	
  <td class="option-cell"><input type="radio" name="p111" value="3"></td>
  <td class="option-cell"><input type="radio" name="p111" value="2"></td>
  <td class="option-cell"><input type="radio" name="p111" value="1"></td>
  <td class="option-cell"><input type="radio" name="p111" value="0"></td>	
</tr>						
						
<!-- Pregunta 112 -->
<tr>						
  <td class="question-cell">112. Para hacer mi trabajo debo demostrar sentimientos distintos a los míos</td>			
  <td class="option-cell"><input type="radio" name="p112" value="4"></td>	
  <td class="option-cell"><input type="radio" name="p112" value="3"></td>
  <td class="option-cell"><input type="radio" name="p112" value="2"></td>
  <td class="option-cell"><input type="radio" name="p112" value="1"></td>
  <td class="option-cell"><input type="radio" name="p112" value="0"></td>	
</tr>						
						
<!-- Pregunta 113 -->
<tr>						
  <td class="question-cell">113. Mi trabajo me exige atender situaciones de violencia</td>			
  <td class="option-cell"><input type="radio" name="p113" value="4"></td>	
  <td class="option-cell"><input type="radio" name="p113" value="3"></td>
  <td class="option-cell"><input type="radio" name="p113" value="2"></td>
  <td class="option-cell"><input type="radio" name="p113" value="1"></td>
  <td class="option-cell"><input type="radio" name="p113" value="0"></td>	
</tr>						
						
<!-- Pregunta 114 -->
<tr>						
  <td class="question-cell">114. Mi trabajo me exige atender situaciones muy tristes o dolorosas</td>			
  <td class="option-cell"><input type="radio" name="p114" value="4"></td>	
  <td class="option-cell"><input type="radio" name="p114" value="3"></td>
  <td class="option-cell"><input type="radio" name="p114" value="2"></td>
  <td class="option-cell"><input type="radio" name="p114" value="1"></td>
  <td class="option-cell"><input type="radio" name="p114" value="0"></td>	
</tr>


</table>
</body>


<body>

        <p class="intro-text"></p>



            
                <tbody>


                    <!-- Pregunta de validación 2 -->
                    <tr>
                        <td class="question-cell">Soy  jefe de otras personas en mi trabajo</td>
                        <td class="option-cell" colspan="5">
                            <label><input type="radio" name="pval2" value="Sí"> Sí</label>
                            <label><input type="radio" name="pval2" value="No"> No</label>
                        </td>
                    </tr>
                </tbody>
            </table>

            <button type="submit" id="submitBtn">Enviar</button>
        </form>

<div id="results" class="hidden result">
    <h2>Resultados</h2>
    <div id="resultsContainer">
        <!-- Resultados de preguntas del 106 al 114 -->
        <script>
            // Generar elementos <p> para preguntas del 106 al 114
            document.write([...Array(114).keys()].map(i => `<p id="resultP${i + 105}"></p>`).join(''));
            // Agregar el elemento <p> para la pregunta de validación
            document.write('<p id="resultPval2"></p>');
        </script>
    </div>
</div>


<script>
const p1a105results = JSON.parse(localStorage.getItem('p1a105results')) || {};

// JSON con los límites para cada dimensión, dominio y cuestionario
const riskLevels = {
    "dom3dim2": [
        { "level": "Sin riesgo", "min": 0, "max": 16.7, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 16.7, "minComparison": ">", "max": 25, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 25, "minComparison": ">", "max": 33.3, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 33.3, "minComparison": ">", "max": 47.2, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 47.2, "minComparison": ">", "max": 100, "maxComparison": "<=" }
],
            "dom1dim1": [
        { "level": "Sin riesgo", "min": 0, "max": 3.8, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 3.8, "minComparison": ">", "max": 15.4, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 15.4, "minComparison": ">", "max": 30.8, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 30.80, "minComparison": ">", "max": 46.2, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 46.2, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom1dim2": [
        { "level": "Sin riesgo", "min": 0, "max": 5.4, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 5.4, "minComparison": ">", "max": 16.1, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 16.1, "minComparison": ">", "max": 25, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 25, "minComparison": ">", "max": 37.5, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 37.5, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom1dim3": [
        { "level": "Sin riesgo", "min": 0, "max": 10, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 10, "minComparison": ">", "max": 25, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 25, "minComparison": ">", "max": 40, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 40, "minComparison": ">", "max": 55, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 55, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],

    "dom2dim1": [
        { "level": "Sin riesgo", "min": 0, "max": 0.9, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 0.9, "minComparison": ">", "max": 10.7, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 10.7, "minComparison": ">", "max": 21.4, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 21.4, "minComparison": ">", "max": 39.3, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 39.3, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom2dim2": [
        { "level": "Sin riesgo", "min": 0, "max": 0.9, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 0.9, "minComparison": ">", "max": 16.7, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 16.7, "minComparison": ">", "max": 33.3, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 33.3, "minComparison": ">", "max": 50, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 50, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom2dim3": [
        { "level": "Sin riesgo", "min": 0, "max": 12.5, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 12.5, "minComparison": ">", "max": 25, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 25, "minComparison": ">", "max": 37.5, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 37.5, "minComparison": ">", "max": 50, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 50, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom2dim4": [
        { "level": "Sin riesgo", "min": 0, "max": 0.9, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 0.9, "minComparison": ">", "max": 6.3, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 6.3, "minComparison": ">", "max": 18.8, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 18.8, "minComparison": ">", "max": 31.3, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 31.3, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom2dim5": [
        { "level": "Sin riesgo", "min": 0, "max": 8.3, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 8.3, "minComparison": ">", "max": 25, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 25, "minComparison": ">", "max": 41.7, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 41.7, "minComparison": ">", "max": 58.3, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 58.3, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],

    "dom3dim1": [
        { "level": "Sin riesgo", "min": 0, "max": 14.6, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 14.6, "minComparison": ">", "max": 22.9, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 22.9, "minComparison": ">", "max": 31.3, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 31.3, "minComparison": ">", "max": 39.6, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 39.6, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom3dim3": [
        { "level": "Sin riesgo", "min": 0, "max": 25, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 25, "minComparison": ">", "max": 33.3, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 33.3, "minComparison": ">", "max": 45.8, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 45.8, "minComparison": ">", "max": 54.2, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 54.2, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom3dim4": [
        { "level": "Sin riesgo", "min": 0, "max": 18.8, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 18.8, "minComparison": ">", "max": 31.3, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 31.3, "minComparison": ">", "max": 43.8, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 43.8, "minComparison": ">", "max": 50, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 50, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom3dim5": [
        { "level": "Sin riesgo", "min": 0, "max": 37.5, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 37.5, "minComparison": ">", "max": 54.2, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 54.2, "minComparison": ">", "max": 66.7, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 66.7, "minComparison": ">", "max": 79.2, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 79.2, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom3dim6": [
        { "level": "Sin riesgo", "min": 0, "max": 60, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 60, "minComparison": ">", "max": 70, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 70, "minComparison": ">", "max": 80, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 80, "minComparison": ">", "max": 90, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 90, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom3dim7": [
        { "level": "Sin riesgo", "min": 0, "max": 15, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 15, "minComparison": ">", "max": 25, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 25, "minComparison": ">", "max": 35, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 35, "minComparison": ">", "max": 45, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 45, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom3dim8": [
        { "level": "Sin riesgo", "min": 0, "max": 8.3, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 8.3, "minComparison": ">", "max": 25, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 25, "minComparison": ">", "max": 33.3, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 33.3, "minComparison": ">", "max": 50, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 50, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom4dim1": [
        { "level": "Sin riesgo", "min": 0, "max": 0.9, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 0.9, "minComparison": ">", "max": 5, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 5, "minComparison": ">", "max": 10, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 10, "minComparison": ">", "max": 20, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 20, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "dom4dim2": [
        { "level": "Sin riesgo", "min": 0, "max": 4.2, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 4.2, "minComparison": ">", "max": 16.7, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 16.7, "minComparison": ">", "max": 25, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 25, "minComparison": ">", "max": 37.5, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 37.5, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],

    "group1": [
        { "level": "Sin riesgo", "min": 0, "max": 9.1, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 9.1, "minComparison": ">", "max": 17.7, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 17.7, "minComparison": ">", "max": 25.6, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 25.6, "minComparison": ">", "max": 34.8, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 34.8, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "group2": [
        { "level": "Sin riesgo", "min": 0, "max": 10.7, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 10.7, "minComparison": ">", "max": 19, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 19, "minComparison": ">", "max": 29.8, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 29.8, "minComparison": ">", "max": 40.5, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 40.5, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "group3": [
        { "level": "Sin riesgo", "min": 0, "max": 28.5, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 28.5, "minComparison": ">", "max": 35, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 35, "minComparison": ">", "max": 41.5, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 41.5, "minComparison": ">", "max": 47.5, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 47.5, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "group4": [
        { "level": "Sin riesgo", "min": 0, "max": 4.5, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 4.5, "minComparison": ">", "max": 11.4, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 11.4, "minComparison": ">", "max": 20.5, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 20.5, "minComparison": ">", "max": 29.5, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 29.5, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ],
    "questionnaireFactor": [
        { "level": "Sin riesgo", "min": 0, "max": 19.7, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 19.7, "minComparison": ">", "max": 25.8, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 25.8, "minComparison": ">", "max": 31.5, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 31.5, "minComparison": ">", "max": 38, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 38, "minComparison": ">", "max": 100, "maxComparison": "<=" }
    ]
    };

// Función para obtener el nivel de riesgo basado en el puntaje
function getRiskLevel(dimension, score) {
    const levels = riskLevels[dimension];
    if (!levels) return "Dimensión no encontrada";
    
    for (const level of levels) {
        const { min, max, minComparison, maxComparison } = level;
        if (
            (minComparison === ">" && score > min || minComparison === undefined && score >= min) &&
            (maxComparison === "<=" && score <= max || maxComparison === undefined && score < max)
        ) {
            return level.level;
        }
    }
    return "Puntuación fuera de rango";
}

function calculateSetSum(set) {
    return set.questions.reduce((sum, questionNumber) => {
        const value = document.querySelector(`input[name="p${questionNumber}"]:checked`)?.value;
        return sum + (value ? parseInt(value, 10) : 0);
    }, 0);
}

function getValidationAnswer() {
    return document.querySelector('input[name="pval2"]:checked')?.value;
}

function calculateTransformedScore(rawScore, factor) {
    return (rawScore * 100) / factor;
}

async function sendResultsToServer(data) {
    try {
        const response = await fetch('https://yourapi.example.com/save-results', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        });

        if (!response.ok) {
            throw new Error('Error al almacenar los resultados en el servidor.');
        }
    } catch (error) {
        console.error('Error al enviar datos al servidor:', error);
    }
}

// Función para mostrar los resultados en una tabla emergente
function showResultsTable(results) {
    const table = document.createElement('table');
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = '<th>Dimensión</th><th>Puntaje Bruto</th><th>Puntaje Transformado</th><th>Nivel de Riesgo</th>';
    table.appendChild(headerRow);

    for (const [key, value] of Object.entries(results)) {
        if (key.endsWith('_transformed')) {
            const dimId = key.split('_')[0];
            const rawScore = results[dimId];
            const riskLevel = results[`${dimId}_risk_level`];
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dimId}</td>
                <td>${rawScore}</td>
                <td>${value}</td>
                <td>${riskLevel}</td>
            `;
            table.appendChild(row);
        }
    }

    const popup = window.open('', '_blank', 'width=600,height=400');
    popup.document.write('<html><head><title>Resultados</title></head><body>');
    popup.document.write('<h1>Resultados del Cuestionario</h1>');
    popup.document.write(table.outerHTML);
    popup.document.write('</body></html>');
    popup.document.close();
}

document.getElementById('submitBtn').addEventListener('click', async function (event) {
    event.preventDefault(); // Evita el envío del formulario

    let allAnswered = true;
    const missingQuestions = [];
    const responses = {}; // Para almacenar las respuestas

    // Conjuntos de preguntas agrupados
    const groupedSets = [
        {
            groupId: 'group1',
            sets: [
            ]
        },
        {
            groupId: 'group2',
            sets: [
            ]
        },
        {
            groupId: 'group3',
            sets: [
                { id: 'dom3dim2', questions: [106,107,108,109,110,111,112,113,114] }
            ]
        },
        {
            groupId: 'group4',
            sets: [
            ]
        },

    ];

        // Factores de Transformación por Dimensión
        const transformationFactors = {
dom3dim2: 36,
            dom1dim1: 52, dom1dim2: 56, dom1dim3: 20,
            dom2dim1: 28, dom2dim2: 12, dom2dim3: 16,
            dom2dim4: 16, dom2dim5: 12,
            dom3dim1: 48, dom3dim3: 24, dom3dim4: 16,
            dom3dim5: 24, dom3dim6: 20, dom3dim7: 20,
            dom3dim8: 12,
            dom4dim1: 20, dom4dim2: 24
        };

        // Factores de Transformación por Dominio
        const domainTransformationFactors = {
            group1: 164, group2: 84, group3: 200, group4: 44
        };

    // Factor de Transformación del Cuestionario
    const questionnaireFactor = 492;

    // Itera sobre los números de preguntas del 106 al 114
    for (let j = 106; j <= 114; j++) {
        const question = document.querySelector(`input[name="p${j}"]:checked`);
        if (question) {
            responses[`p${j}`] = question.value;
        } else {
            allAnswered = false;
            missingQuestions.push(j);
        }
    }

    // Verifica la pregunta de validación pval2
    const pval2 = getValidationAnswer();
    if (!pval2) {
        allAnswered = false;
        missingQuestions.push('Pregunta relacionada con las personas que usted supervisa o dirige');
    }

    if (!allAnswered) {
        const missingQuestionsText = missingQuestions.join(', ');
        alert(`Por favor, responda las preguntas que faltaron: ${missingQuestionsText}`);
        return;
    }

    const sums = {};
    const dimensionScores = {};
    const domainScores = {};

    // Calcular puntajes brutos para cada dominio
    groupedSets.forEach(group => {
        let groupTotal = 0;
        group.sets.forEach(set => {
            const setSum = calculateSetSum(set);
            sums[set.id] = (p1a105results[set.id] || 0) + setSum; // Combina con los resultados anteriores
            dimensionScores[set.id] = sums[set.id];
            groupTotal += sums[set.id];
        });
        domainScores[group.groupId] = (p1a105results[group.groupId] || 0) + groupTotal; // Combina con los resultados anteriores
    });

    // Calcula y almacena los puntajes brutos para cada grupo
    const results = {};
    for (const group of groupedSets) {
        for (const set of group.sets) {
            const rawScore = sums[set.id];
            const transformedScore = calculateTransformedScore(rawScore, transformationFactors[set.id]);
            results[set.id] = rawScore;
            results[`${set.id}_transformed`] = transformedScore;
            results[`${set.id}_risk_level`] = getRiskLevel(set.id, transformedScore);
        }
        const groupRawScore = domainScores[group.groupId];
        const groupTransformedScore = calculateTransformedScore(groupRawScore, domainTransformationFactors[group.groupId]);
        results[group.groupId] = groupRawScore;
        results[`${group.groupId}_transformed`] = groupTransformedScore;
        results[`${group.groupId}_risk_level`] = getRiskLevel(group.groupId, groupTransformedScore);
    }
    results['questionnaireFactor'] = calculateTransformedScore(calculateSetSum({ questions: groupedSets.flatMap(group => group.sets.flatMap(set => set.questions)) }), questionnaireFactor);

    const questionnaireScore = Object.values(domainScores).reduce((total, score) => total + score, 0);
    sums['cuestionario'] = questionnaireScore;

    const transformedScores = {};

    Object.entries(dimensionScores).forEach(([id, score]) => {
        const transformedScore = calculateTransformedScore(score, transformationFactors[id]);
        transformedScores[`${id}_transformed`] = transformedScore;
        transformedScores[`${id}_risk_level`] = getRiskLevel(id, transformedScore);
    });

    Object.entries(domainScores).forEach(([id, score]) => {
        const transformedScore = calculateTransformedScore(score, domainTransformationFactors[id]);
        transformedScores[`${id}_transformed`] = transformedScore;
        transformedScores[`${id}_risk_level`] = getRiskLevel(id, transformedScore);
    });

    const questionnaireTransformedScore = calculateTransformedScore(questionnaireScore, questionnaireFactor);
    transformedScores['cuestionario_transformed'] = questionnaireTransformedScore;
    transformedScores['cuestionario_risk_level'] = getRiskLevel('questionnaireFactor', questionnaireTransformedScore);

    // Mostrar los resultados en una tabla emergente
    showResultsTable({ ...sums, ...transformedScores, ...results });

    // Actualizar el almacenamiento local con los nuevos resultados combinados
    localStorage.setItem('p1a105results', JSON.stringify({ ...p1a105results, ...results }));

    await sendResultsToServer({ ...sums, ...transformedScores, ...results });

    if (pval2 === 'Sí') {
        window.location.href = 'form3-part4-intraA.html';
    } else if (pval2 === 'No') {
        window.location.href = 'form3-part3-intraA.html';
    }
});
</script>



</body>
</html>
