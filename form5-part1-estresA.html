<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Preguntas</title>
    <style>

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #e8f5e9; /* Fondo Verde Claro */
}

.container {
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

h1 {
    text-align: center;
    color: #000000; /* Verde Oscuro */
    font-size: 1.3em; /* Tamaño de fuente para el título */
    font-family: 'Arial', sans-serif; /* Tipo de fuente para el título */
    font-weight: bold; /* Peso de la fuente para hacer el título más destacado */
    margin: 0 0 20px; /* Márgenes para el título (0 arriba, 0 abajo, 20px en la parte inferior) */
}


.intro-text {
    margin-bottom: 20px; /* Espacio debajo del texto introductorio */
    font-size: 16px; /* Tamaño de fuente adecuado */
    line-height: 1.4; /* Altura de línea para mejorar la legibilidad */
}

.table-container {
    width: 100%; /* Asegura que el contenedor de la tabla ocupe todo el ancho disponible */
    overflow-x: auto; /* Permite el desplazamiento horizontal si es necesario */
}

table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed; /* Asegura que todas las celdas de la tabla tengan el mismo ancho */
}

thead th {
    background-color: #f1f8e9; /* Verde Muy Claro */
    color: #000000; /* Verde Más Oscuro */
}

th, td {
    border: 1px solid #000000; /* negro */
    padding: 8px;
    text-align: center;
    box-sizing: border-box; /* Incluye el padding y border en el ancho total de las celdas */
}

th:nth-child(1), td:nth-child(1) {
    width: 60%; /* Columna de preguntas ocupa el 60% del ancho */
}

th:nth-child(2), td:nth-child(2),
th:nth-child(3), td:nth-child(3),
th:nth-child(4), td:nth-child(4),
th:nth-child(5), td:nth-child(5),
th:nth-child(6), td:nth-child(6) {
    width: 10%; /* Cada columna de opciones de respuesta ocupa el ancho que debe ocupar*/
}

.question-header {
    text-align: center;
    font-weight: normal;
}

.question-cell {
    text-align: left;
}

.option-cell {
    text-align: center;
}

button {
    display: block;
    width: 100%;
    padding: 10px;
    background-color: #66bb6a; /* Verde Claro */
    color: #ffffff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    margin-top: 20px;
}

button:hover {
    background-color: #43a047; /* Verde Más Oscuro */
}

.hidden {
    display: none;
}

.result {
    padding: 10px;
    background-color: #e8f5e9; /* Verde Claro */
    border: 2px solid #66bb6a; /* Verde Claro */
    border-radius: 5px;
}



    </style>
</head>
<body>
    <div class="container">
        <h1>CUESTIONARIO PARA LA EVALUACIÓN DEL ESTRÉS - TERCERA VERSIÓN</h1>

        <p class="intro-text">Señale la casilla que indique la frecuencia con que se le han presentado los siguientes malestares en los últimos tres meses.</p>


        <form id="questionForm">
            <table>
                <thead>
                    <tr>
                        <th class="question-header"></th>
                        <th class="question-header">Siempre</th>
                        <th class="question-header">Casi Siempre</th>
                        <th class="question-header">A Veces</th>
                        <th class="question-header">Nunca</th>
                    </tr>
                </thead>
                <tbody>


<!--	Pregunta		1	-->	
<tr>					
<td	class="question-cell">	1. 	Dolores en el cuello y espalda o tensión muscular.</td>		
<td	class="option-cell"><input		type="radio"	name="p1"	value="9"></td>
<td	class="option-cell"><input		type="radio"	name="p1"	value="6"</td>
<td	class="option-cell"><input		type="radio"	name="p1"	value="3"</td>
<td	class="option-cell"><input		type="radio"	name="p1"	value="0"></td>
</tr>					
					
<!--	Pregunta		2	-->	
<tr>					
<td	class="question-cell">	2. 	Problemas gastrointestinales, úlcera péptica, acidez, problemas digestivos o del colon.</td>		
<td	class="option-cell"><input		type="radio"	name="p2"	value="9"></td>
<td	class="option-cell"><input		type="radio"	name="p2"	value="6"</td>
<td	class="option-cell"><input		type="radio"	name="p2"	value="3"</td>
<td	class="option-cell"><input		type="radio"	name="p2"	value="0"></td>
</tr>					
					
<!--	Pregunta		3	-->	
<tr>					
<td	class="question-cell">	3. 	Problemas respiratorios.</td>		
<td	class="option-cell"><input		type="radio"	name="p3"	value="9"></td>
<td	class="option-cell"><input		type="radio"	name="p3"	value="6"</td>
<td	class="option-cell"><input		type="radio"	name="p3"	value="3"</td>
<td	class="option-cell"><input		type="radio"	name="p3"	value="0"></td>
</tr>					
					
<!--	Pregunta		4	-->	
<tr>					
<td	class="question-cell">	4. 	Dolor de cabeza.</td>		
<td	class="option-cell"><input		type="radio"	name="p4"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p4"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p4"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p4"	value="0"></td>
</tr>					
					
<!--	Pregunta		5	-->	
<tr>					
<td	class="question-cell">	5. 	Transtornos del sueño como somnolencia durante el día o desvelo en la noche.</td>		
<td	class="option-cell"><input		type="radio"	name="p5"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p5"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p5"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p5"	value="0"></td>
</tr>					
					
<!--	Pregunta		6	-->	
<tr>					
<td	class="question-cell">	6. 	Palpitaciones en el pecho o problemas cardíacos.</td>		
<td	class="option-cell"><input		type="radio"	name="p6"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p6"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p6"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p6"	value="0"></td>
</tr>					
					
<!--	Pregunta		7	-->	
<tr>					
<td	class="question-cell">	7. 	Cambios fuertes del apetito.</td>		
<td	class="option-cell"><input		type="radio"	name="p7"	value="3"></td>
<td	class="option-cell"><input		type="radio"	name="p7"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p7"	value="1"</td>
<td	class="option-cell"><input		type="radio"	name="p7"	value="0"></td>
</tr>					
					
<!--	Pregunta		8	-->	
<tr>					
<td	class="question-cell">	8. 	Problemas relacionados con la función de los órganos genitales (impotencia, frigidez).</td>		
<td	class="option-cell"><input		type="radio"	name="p8"	value="3"></td>
<td	class="option-cell"><input		type="radio"	name="p8"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p8"	value="1"</td>
<td	class="option-cell"><input		type="radio"	name="p8"	value="0"></td>
</tr>					
					
<!--	Pregunta		9	-->	
<tr>					
<td	class="question-cell">	9. 	Dificultad en las relaciones familiares.</td>		
<td	class="option-cell"><input		type="radio"	name="p9"	value="9"></td>
<td	class="option-cell"><input		type="radio"	name="p9"	value="6"</td>
<td	class="option-cell"><input		type="radio"	name="p9"	value="3"</td>
<td	class="option-cell"><input		type="radio"	name="p9"	value="0"></td>
</tr>					
					
<!--	Pregunta		10	-->	
<tr>					
<td	class="question-cell">	10. 	Dificultad para permanecer quieto o dificultad para iniciar actividades.</td>		
<td	class="option-cell"><input		type="radio"	name="p10"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p10"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p10"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p10"	value="0"></td>
</tr>					
					
<!--	Pregunta		11	-->	
<tr>					
<td	class="question-cell">	11. 	Dificultad en las relaciones con otras personas.</td>		
<td	class="option-cell"><input		type="radio"	name="p11"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p11"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p11"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p11"	value="0"></td>
</tr>					
					
<!--	Pregunta		12	-->	
<tr>					
<td	class="question-cell">	12. 	Sensación de aislamiento o desinterés.</td>		
<td	class="option-cell"><input		type="radio"	name="p12"	value="3"></td>
<td	class="option-cell"><input		type="radio"	name="p12"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p12"	value="1"</td>
<td	class="option-cell"><input		type="radio"	name="p12"	value="0"></td>
</tr>					
					
<!--	Pregunta		13	-->	
<tr>					
<td	class="question-cell">	13. 	Sentimiento de sobrecarga de trabajo.</td>		
<td	class="option-cell"><input		type="radio"	name="p13"	value="9"></td>
<td	class="option-cell"><input		type="radio"	name="p13"	value="6"</td>
<td	class="option-cell"><input		type="radio"	name="p13"	value="3"</td>
<td	class="option-cell"><input		type="radio"	name="p13"	value="0"></td>
</tr>					
					
<!--	Pregunta		14	-->	
<tr>					
<td	class="question-cell">	14. 	Dificultad para concentrarse, olvidos frecuentes.</td>		
<td	class="option-cell"><input		type="radio"	name="p14"	value="9"></td>
<td	class="option-cell"><input		type="radio"	name="p14"	value="6"</td>
<td	class="option-cell"><input		type="radio"	name="p14"	value="3"</td>
<td	class="option-cell"><input		type="radio"	name="p14"	value="0"></td>
</tr>					
					
<!--	Pregunta		15	-->	
<tr>					
<td	class="question-cell">	15. 	Aumento en el número de accidentes de trabajo.</td>		
<td	class="option-cell"><input		type="radio"	name="p15"	value="9"></td>
<td	class="option-cell"><input		type="radio"	name="p15"	value="6"</td>
<td	class="option-cell"><input		type="radio"	name="p15"	value="3"</td>
<td	class="option-cell"><input		type="radio"	name="p15"	value="0"></td>
</tr>					
					
<!--	Pregunta		16	-->	
<tr>					
<td	class="question-cell">	16. 	Sentimiento de frustración, de no haber hecho lo que se quería en la vida.</td>		
<td	class="option-cell"><input		type="radio"	name="p16"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p16"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p16"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p16"	value="0"></td>
</tr>					
					
<!--	Pregunta		17	-->	
<tr>					
<td	class="question-cell">	17. 	Cansancio, tedio o desgano.</td>		
<td	class="option-cell"><input		type="radio"	name="p17"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p17"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p17"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p17"	value="0"></td>
</tr>					
					
<!--	Pregunta		18	-->	
<tr>					
<td	class="question-cell">	18. 	Disminución del rendimiento en el trabajo o poca creatividad.</td>		
<td	class="option-cell"><input		type="radio"	name="p18"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p18"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p18"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p18"	value="0"></td>
</tr>					
					
<!--	Pregunta		19	-->	
<tr>					
<td	class="question-cell">	19. 	Deseo de no asistir al trabajo.</td>		
<td	class="option-cell"><input		type="radio"	name="p19"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p19"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p19"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p19"	value="0"></td>
</tr>					
					
<!--	Pregunta		20	-->	
<tr>					
<td	class="question-cell">	20. 	Bajo compromiso o poco interés con lo que se hace.</td>		
<td	class="option-cell"><input		type="radio"	name="p20"	value="3"></td>
<td	class="option-cell"><input		type="radio"	name="p20"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p20"	value="1"</td>
<td	class="option-cell"><input		type="radio"	name="p20"	value="0"></td>
</tr>					
					
<!--	Pregunta		21	-->	
<tr>					
<td	class="question-cell">	21. 	Dificultad para tomar decisiones.</td>		
<td	class="option-cell"><input		type="radio"	name="p21"	value="3"></td>
<td	class="option-cell"><input		type="radio"	name="p21"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p21"	value="1"</td>
<td	class="option-cell"><input		type="radio"	name="p21"	value="0"></td>
</tr>					
					
<!--	Pregunta		22	-->	
<tr>					
<td	class="question-cell">	22. 	Deseo de cambiar de empleo.</td>		
<td	class="option-cell"><input		type="radio"	name="p22"	value="3"></td>
<td	class="option-cell"><input		type="radio"	name="p22"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p22"	value="1"</td>
<td	class="option-cell"><input		type="radio"	name="p22"	value="0"></td>
</tr>					
					
<!--	Pregunta		23	-->	
<tr>					
<td	class="question-cell">	23. 	Sentimiento de soledad y miedo.</td>		
<td	class="option-cell"><input		type="radio"	name="p23"	value="9"></td>
<td	class="option-cell"><input		type="radio"	name="p23"	value="6"</td>
<td	class="option-cell"><input		type="radio"	name="p23"	value="3"</td>
<td	class="option-cell"><input		type="radio"	name="p23"	value="0"></td>
</tr>					
					
<!--	Pregunta		24	-->	
<tr>					
<td	class="question-cell">	24. 	Sentimiento de irritabilidad, actitudes y pensamientos negativos.</td>		
<td	class="option-cell"><input		type="radio"	name="p24"	value="9"></td>
<td	class="option-cell"><input		type="radio"	name="p24"	value="6"</td>
<td	class="option-cell"><input		type="radio"	name="p24"	value="3"</td>
<td	class="option-cell"><input		type="radio"	name="p24"	value="0"></td>
</tr>					
					
<!--	Pregunta		25	-->	
<tr>					
<td	class="question-cell">	25. 	Sentimiento de angustia, preocupación o tristeza.</td>		
<td	class="option-cell"><input		type="radio"	name="p25"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p25"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p25"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p25"	value="0"></td>
</tr>					
					
<!--	Pregunta		26	-->	
<tr>					
<td	class="question-cell">	26. 	Consumo de drogas para aliviar la tensión o los nervios.</td>		
<td	class="option-cell"><input		type="radio"	name="p26"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p26"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p26"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p26"	value="0"></td>
</tr>					
					
<!--	Pregunta		27	-->	
<tr>					
<td	class="question-cell">	27. 	Sentimientos de que "no vale nada" o "no sirve para nada".</td>		
<td	class="option-cell"><input		type="radio"	name="p27"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p27"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p27"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p27"	value="0"></td>
</tr>					
					
<!--	Pregunta		28	-->	
<tr>					
<td	class="question-cell">	28. 	Consumo de bebidas alcohólicas o café o cigarrillo.</td>		
<td	class="option-cell"><input		type="radio"	name="p28"	value="6"></td>
<td	class="option-cell"><input		type="radio"	name="p28"	value="4"</td>
<td	class="option-cell"><input		type="radio"	name="p28"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p28"	value="0"></td>
</tr>					
					
<!--	Pregunta		29	-->	
<tr>					
<td	class="question-cell">	29. 	Sentimiento de que está perdiendo la razón.</td>		
<td	class="option-cell"><input		type="radio"	name="p29"	value="3"></td>
<td	class="option-cell"><input		type="radio"	name="p29"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p29"	value="1"</td>
<td	class="option-cell"><input		type="radio"	name="p29"	value="0"></td>
</tr>					
					
<!--	Pregunta		30	-->	
<tr>					
<td	class="question-cell">	30. 	Comportamientos rígidos, obstinación o terquedad.</td>		
<td	class="option-cell"><input		type="radio"	name="p30"	value="3"></td>
<td	class="option-cell"><input		type="radio"	name="p30"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p30"	value="1"</td>
<td	class="option-cell"><input		type="radio"	name="p30"	value="0"></td>
</tr>					
					
<!--	Pregunta		31	-->	
<tr>					
<td	class="question-cell">	31. 	Sensación de no poder manejar los problemas de la vida.</td>		
<td	class="option-cell"><input		type="radio"	name="p31"	value="3"></td>
<td	class="option-cell"><input		type="radio"	name="p31"	value="2"</td>
<td	class="option-cell"><input		type="radio"	name="p31"	value="1"</td>
<td	class="option-cell"><input		type="radio"	name="p31"	value="0"></td>
</tr>					
	

</table>
</body>

<body>


            </table>

            <button type="submit" id="submitBtn">Enviar</button>
        </form>

<div id="results" class="hidden result">
    <h2>Resultados</h2>
    <div id="resultsContainer">
        <!-- Resultados de preguntas del 1 al 31 -->
        <script>
            // Generar elementos <p> para preguntas del 1 al 31
            document.write([...Array(31).keys()].map(i => `<p id="resultP${i + 1}"></p>`).join(''));
        </script>
    </div>
</div>


<script>

const p1a105results = JSON.parse(localStorage.getItem('p1a105results')) || {};

// JSON con los límites para cada dimensión, dominio y cuestionario
const riskLevels = {
    "group6": [
        { "level": "Sin riesgo", "min": 0, "max": 7.8, "maxComparison": "<=" },
        { "level": "Riesgo bajo", "min": 7.8, "minComparison": ">", "max": 12.6, "maxComparison": "<=" },
        { "level": "Riesgo medio", "min": 12.6, "minComparison": ">", "max": 17.7, "maxComparison": "<=" },
        { "level": "Riesgo alto", "min": 17.7, "minComparison": ">", "max": 25, "maxComparison": "<=" },
        { "level": "Riesgo muy alto", "min": 25, "minComparison": ">", "max": 101, "maxComparison": "<=" }
    ],
};

// Función para obtener el nivel de riesgo basado en el puntaje
function getRiskLevel(dimension, score) {
    const levels = riskLevels[dimension];
    if (!levels) return "Dimensión no encontrada";
    
    for (const level of levels) {
        const { min, max, minComparison, maxComparison } = level;
        if (
            (minComparison === ">" && score > min || minComparison === undefined && score >= min) &&
            (maxComparison === "<=" && score <= max || maxComparison === undefined && score < max)
        ) {
            return level.level;
        }
    }
    return "Puntuación fuera de rango";
}

function calculateSetSum(set) {
    return set.questions.reduce((sum, questionNumber) => {
        const value = document.querySelector(`input[name="p${questionNumber}"]:checked`)?.value;
        return sum + (value ? parseInt(value, 10) : 0);
    }, 0);
}

function calculateTransformedScore(rawScore, factor) {
    return (rawScore * 100) / factor;
}

async function sendResultsToServer(data) {
    try {
        const response = await fetch('https://yourapi.example.com/save-results', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        });

        if (!response.ok) {
            throw new Error('Error al almacenar los resultados en el servidor.');
        }
    } catch (error) {
        console.error('Error al enviar datos al servidor:', error);
    }
}

// Función para mostrar los resultados en una tabla emergente
function showResultsTable(results) {
    const table = document.createElement('table');
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = '<th>Dimensión</th><th>Puntaje Bruto</th><th>Puntaje Transformado</th><th>Nivel de Riesgo</th>';
    table.appendChild(headerRow);

    for (const [key, value] of Object.entries(results)) {
        if (key.endsWith('_transformed')) {
            const dimId = key.split('_')[0];
            const rawScore = results[dimId];
            const riskLevel = results[`${dimId}_risk_level`];
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dimId}</td>
                <td>${rawScore}</td>
                <td>${value}</td>
                <td>${riskLevel}</td>
            `;
            table.appendChild(row);
        }
    }

    const popup = window.open('', '_blank', 'width=600,height=400');
    popup.document.write('<html><head><title>Resultados</title></head><body>');
    popup.document.write('<h1>Resultados del Cuestionario</h1>');
    popup.document.write(table.outerHTML);
    popup.document.write('</body></html>');
    popup.document.close();
}

document.getElementById('submitBtn').addEventListener('click', async function (event) {
    event.preventDefault(); // Evita el envío del formulario

    let allAnswered = true;
    const missingQuestions = [];
    const responses = {}; // Para almacenar las respuestas

    // Conjuntos de preguntas agrupados
    const groupedSets = [
        {
            groupId: 'group6',
            sets: [
                { id: 'dom6dim1', questions: [1,2,3,4,5,6,7,8] },
                { id: 'dom6dim2', questions: [9,10,11,12] },
                { id: 'dom6dim3', questions: [13,14,15,16,17,18,19,20,21,22] },
                { id: 'dom6dim4', questions: [23,24,25,26,27,28,29,30,31] },
            ]
        },
    ];

    // Factores de Transformación por Dimensión
    const transformationFactors = {
        dom6dim1: 100,   // Para obtener el resultado en la escala deseada
        dom6dim2: 100,   // Para obtener el resultado en la escala deseada
        dom6dim3: 100,  // Para obtener el resultado en la escala deseada
        dom6dim4: 100,   // Para obtener el resultado en la escala deseada
    };

    // Factores de Transformación por Dominio
    const domainTransformationFactors = {
        group6: 61.16
    };

    // Itera sobre los números de preguntas del 1 al 31
    for (let j = 1; j <= 31; j++) {
        const question = document.querySelector(`input[name="p${j}"]:checked`);
        if (question) {
            responses[`p${j}`] = question.value;
        } else {
            allAnswered = false;
            missingQuestions.push(j);
        }
    }

    if (!allAnswered) {
        const missingQuestionsText = missingQuestions.join(', ');
        alert(`Por favor, responda las preguntas que faltaron: ${missingQuestionsText}`);
        return;
    }

    const sums = {};
    const dimensionScores = {};
    const domainScores = {};

    // Calcular puntajes brutos para cada dominio
    groupedSets.forEach(group => {
        let groupTotal = 0;
        group.sets.forEach(set => {
            const setSum = calculateSetSum(set);
            sums[set.id] = (p1a105results[set.id] || 0) + setSum; // Combina con los resultados anteriores
            dimensionScores[set.id] = sums[set.id];
            groupTotal += sums[set.id];
        });
        domainScores[group.groupId] = groupTotal; // Ya sumado
    });

    // Ajustar puntajes de cada dimensión
    const adjustedDimensionScores = {
        dom6dim1: (dimensionScores['dom6dim1'] * 4) / 8,
        dom6dim2: (dimensionScores['dom6dim2'] * 3) / 4,
        dom6dim3: (dimensionScores['dom6dim3'] * 2) / 10,
        dom6dim4: (dimensionScores['dom6dim4'] * 1) / 9,
    };

    // Actualizar la suma del grupo con los puntajes ajustados
    const group6Total = Object.values(adjustedDimensionScores).reduce((sum, score) => sum + score, 0);
    domainScores['group6'] = group6Total;

    // Calcula y almacena los puntajes brutos para cada grupo
    const results = {};
    for (const group of groupedSets) {
        for (const set of group.sets) {
            const rawScore = sums[set.id];
            const transformedScore = calculateTransformedScore(rawScore, transformationFactors[set.id]);
            results[set.id] = rawScore;
            results[`${set.id}_transformed`] = transformedScore;
            results[`${set.id}_risk_level`] = getRiskLevel(set.id, transformedScore);
        }
        const groupRawScore = domainScores[group.groupId];
        const groupTransformedScore = calculateTransformedScore(groupRawScore, domainTransformationFactors[group.groupId]);
        results[group.groupId] = groupRawScore;
        results[`${group.groupId}_transformed`] = groupTransformedScore;
        results[`${group.groupId}_risk_level`] = getRiskLevel(group.groupId, groupTransformedScore);
    }

    const transformedScores = {};

    Object.entries(dimensionScores).forEach(([id, score]) => {
        const transformedScore = calculateTransformedScore(score, transformationFactors[id]);
        transformedScores[`${id}_transformed`] = transformedScore;
        transformedScores[`${id}_risk_level`] = getRiskLevel(id, transformedScore);
    });

    Object.entries(domainScores).forEach(([id, score]) => {
        const transformedScore = calculateTransformedScore(score, domainTransformationFactors[id]);
        transformedScores[`${id}_transformed`] = transformedScore;
        transformedScores[`${id}_risk_level`] = getRiskLevel(id, transformedScore);
    });

    // Mostrar los resultados en una tabla emergente
    showResultsTable({ ...sums, ...transformedScores });

    // Actualizar el almacenamiento local con los nuevos resultados combinados
    localStorage.setItem('p1a105results', JSON.stringify({ ...p1a105results }));

        // Envía los resultados al servidor
        await sendResultsToServer(sums);

        // Redirige a 'index.html'
        window.location.href = 'index.html';
    });
</script>



</body>
</html>
